<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sign in â€” AsSip</title>
  <style>
    body{font-family:system-ui, -apple-system, "Segoe UI",Roboto,Arial;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#faf8f6}
    .box{background:#fff;padding:22px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,0.06);width:360px;max-width:92%}
    input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ddd}
    .btn{background:#0b6b3a;color:white;padding:10px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:700;width:100%}
    .muted{font-size:13px;color:#666;margin-top:8px}
    #recaptcha-container{margin:8px 0}
  </style>
</head>
<body>
  <div class="box">
    <h3>Sign in with Phone</h3>
    <div class="muted">Enter phone number with country code (e.g. +9198xxxxxxxx)</div>

    <input id="phone" placeholder="+91 98XXXXXXXX" />
    <div id="recaptcha-container"></div>
    <button id="sendOtp" class="btn">Send OTP</button>

    <div id="otpSection" style="display:none">
      <input id="otp" placeholder="Enter OTP (6 digits)" />
      <button id="verifyOtp" class="btn">Verify OTP</button>
    </div>

    <div id="status" style="margin-top:10px;color:#333"></div>
    <div style="margin-top:12px;">
      <button id="signOutBtn" class="btn" style="background:#777;display:none">Sign Out</button>
    </div>
  </div>

<script type="module">
  // ====== Replace with your Firebase web app config ======
const firebaseConfig = {
  apiKey: "AIzaSyAUZmRz36SioY54OEIr_DpeCpvJsBMSWec",
  authDomain: "assip-29f4e.firebaseapp.com",
  projectId: "assip-29f4e",
  storageBucket: "assip-29f4e.appspot.com",
  messagingSenderId: "1025217536664",
  appId: "1:1025217536664:web:c8a39df26959ef9ef626ed",
  measurementId: "G-N4MWTTQ7Q2"
};
  const firebaseConfig = {
    apiKey: "REPLACE_API_KEY",
    authDomain: "REPLACE_AUTH_DOMAIN",
    projectId: "REPLACE_PROJECT_ID"
  };
  // =====================================================

  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
  import { getAuth, signInWithPhoneNumber, RecaptchaVerifier, signOut } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // invisible reCAPTCHA rendered into #recaptcha-container by Firebase
  const recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' }, auth);

  const phoneInput = document.getElementById('phone');
  const sendOtpBtn = document.getElementById('sendOtp');
  const otpSection = document.getElementById('otpSection');
  const otpInput = document.getElementById('otp');
  const verifyOtpBtn = document.getElementById('verifyOtp');
  const status = document.getElementById('status');
  const signOutBtn = document.getElementById('signOutBtn');
  let confirmationResult = null;

  sendOtpBtn.addEventListener('click', async () => {
    const phone = phoneInput.value.trim();
    if(!phone){ alert('Enter phone number with country code'); return; }
    status.textContent = 'Sending OTP...';
    try {
      confirmationResult = await signInWithPhoneNumber(auth, phone, recaptchaVerifier);
      status.textContent = 'OTP sent. Check your phone.';
      otpSection.style.display = 'block';
    } catch (err) {
      console.error(err);
      status.textContent = 'Error sending OTP: ' + (err.message || err.code);
    }
  });

  verifyOtpBtn.addEventListener('click', async () => {
    const code = otpInput.value.trim();
    if(!code){ alert('Enter OTP'); return; }
    status.textContent = 'Verifying...';
    try {
      const result = await confirmationResult.confirm(code);
      const user = result.user;
      status.textContent = `Signed in as ${user.phoneNumber}`;
      signOutBtn.style.display = 'block';
      // Redirect to account page after short delay
      setTimeout(()=>{ window.location.href = '/account.html'; }, 700);
    } catch (err) {
      console.error(err);
      status.textContent = 'OTP verification failed: ' + (err.message || err.code);
    }
  });

  signOutBtn.addEventListener('click', async () => {
    await signOut(auth);
    status.textContent = 'Signed out';
    signOutBtn.style.display = 'none';
    otpSection.style.display = 'none';
  });
</script>
</body>
</html>
